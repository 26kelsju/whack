<!DOCTYPE html>
<html>
<head>
    <title>Whack-A-Mole VR</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
</head>
<body>
    <a-scene background="color: #87CEEB">

        <a-assets>
        </a-assets>

        <a-camera>
            <a-cursor 
                raycaster="objects: .mole" 
                fuse="true" 
                fuse-timeout="1000">
            </a-cursor>
        </a-camera>

        <a-entity id="scoreText" 
            text="value: Score: 0; color: #FFF; align: center;" 
            position="0 2.5 -3"
            scale="2 2 2">
        </a-entity>

        <a-plane 
            position="0 0 -4" 
            rotation="-90 0 0" 
            width="10" 
            height="10" 
            color="#4CAF50"
            shadow>
        </a-plane>

        <a-entity class="mole" mole position="-2 0.5 -5"></a-entity>
        <a-entity class="mole" mole position="0 0.5 -5"></a-entity>
        <a-entity class="mole" mole position="2 0.5 -5"></a-entity>
        <a-entity class="mole" mole position="-2 0.5 -3"></a-entity>
        <a-entity class="mole" mole position="0 0.5 -3"></a-entity>
        <a-entity class="mole" mole position="2 0.5 -3"></a-entity>


        <script>
            // Global score variable
            let score = 0;

            // Register a custom A-Frame component called 'mole'
            AFRAME.registerComponent('mole', {
                // The 'init' function runs once when the entity is first created.
                init: function () {
                    // Get a reference to the score text entity
                    this.scoreText = document.querySelector('#scoreText');
                    
                    // Set an initial timer for when the mole can pop up
                    this.popDuration = Math.random() * 3000 + 1000; // Random time between 1-4 seconds
                    this.timer = this.popDuration;
                    
                    // Hide the mole initially
                    this.el.setAttribute('visible', false);
                    
                    // Add the 3D shape (either a box or sphere) to the mole entity
                    this.addShape();
                    
                    // Listen for click or gaze-fuse events
                    this.el.addEventListener('click', () => this.whack());
                },

                // The 'tick' function runs on every frame of the game (like a game loop).
                tick: function (time, timeDelta) {
                    // Decrement the timer
                    this.timer -= timeDelta;

                    // If the timer runs out, make the mole pop up
                    if (this.timer <= 0) {
                        this.pop();
                        // Reset the timer for the next pop-up
                        this.timer = this.popDuration;
                    }
                },
                
                // Function to add a random shape to the mole entity
                addShape: function() {
                    let shape;
                    if (Math.random() > 0.5) {
                        // Create a sphere
                        shape = document.createElement('a-sphere');
                        shape.setAttribute('color', '#8B4513'); // Brown
                        shape.setAttribute('radius', '0.5');
                    } else {
                        // Create a box
                        shape = document.createElement('a-box');
                        shape.setAttribute('color', '#A0522D'); // Sienna
                        shape.setAttribute('depth', '1');
                        shape.setAttribute('height', '1');
                        shape.setAttribute('width', '1');
                    }
                    this.el.appendChild(shape);
                },

                // Function to make the mole appear
                pop: function () {
                    if (this.el.getAttribute('visible')) return; // Don't pop if already visible

                    this.el.setAttribute('visible', true);
                    
                    // Animate the mole popping up
                    this.el.setAttribute('animation', {
                        property: 'position.y',
                        to: 1.5,
                        dur: 300,
                        easing: 'easeOutQuad'
                    });

                    // Set a timeout to automatically hide the mole after a short time
                    setTimeout(() => this.hide(), 2000);
                },

                // Function to hide the mole
                hide: function () {
                    if (!this.el.getAttribute('visible')) return; // Don't hide if already hidden

                    // Animate the mole going down
                    this.el.setAttribute('animation', {
                        property: 'position.y',
                        to: 0.5,
                        dur: 300,
                        easing: 'easeInQuad'
                    });
                    
                    // After the animation, set it to invisible
                    setTimeout(() => {
                        this.el.setAttribute('visible', false);
                    }, 300);
                },

                // Function called when the mole is 'whacked'
                whack: function () {
                    if (!this.el.getAttribute('visible')) return; // Can't whack an invisible mole

                    score++; // Increment score
                    this.scoreText.setAttribute('text', 'value', `Score: ${score}`); // Update score display
                    this.hide(); // Hide the mole immediately
                }
            });
        </script>
    </a-scene>
</body>
</html>
