Of course! You've run into a common timing issue. The moles were likely being created and destroyed before their animations could properly play out.

I've revised the code to use A-Frame's built-in animation events instead of timers. This is a more reliable way to ensure the moles pop up, wait, and then go back down correctly.

Revised Game Code
Here is the complete, corrected code. Copy and paste this into your index.html file.

HTML

<!DOCTYPE html>
<html>
<head>
    <title>Whack-A-Mole VR (Revised)</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
</head>
<body>
    <a-scene>
        <a-plane id="ground" position="0 0 -4" rotation="-90 0 0" width="10" height="10" color="#7BC8A4"></a-plane>
        <a-sky color="#87CEEB"></a-sky>

        <a-entity id="mole-holes">
            <a-cylinder class="hole" position="-1.5 0.1 -3" radius="0.4" height="0.1" color="#4a2a0a"></a-cylinder>
            <a-cylinder class="hole" position="0 0.1 -3" radius="0.4" height="0.1" color="#4a2a0a"></a-cylinder>
            <a-cylinder class="hole" position="1.5 0.1 -3" radius="0.4" height="0.1" color="#4a2a0a"></a-cylinder>
            <a-cylinder class="hole" position="-1.5 0.1 -4.5" radius="0.4" height="0.1" color="#4a2a0a"></a-cylinder>
            <a-cylinder class="hole" position="0 0.1 -4.5" radius="0.4" height="0.1" color="#4a2a0a"></a-cylinder>
            <a-cylinder class="hole" position="1.5 0.1 -4.5" radius="0.4" height="0.1" color="#4a2a0a"></a-cylinder>
        </a-entity>

        <a-text id="score-text" value="Score: 0" position="-1.5 2.5 -3" color="black" width="5"></a-text>
        <a-text id="timer-text" value="Time: 30" position="1.5 2.5 -3" color="black" width="5" align="right"></a-text>

        <a-camera>
            <a-cursor color="yellow" raycaster="objects: .mole-entity"></a-cursor>
        </a-camera>

        <script>
            AFRAME.registerComponent('game-logic', {
                schema: {
                    gameDuration: {type: 'number', default: 30000} // 30 seconds
                },

                init: function () {
                    this.holes = document.querySelectorAll('.hole');
                    this.score = 0;
                    this.scoreText = document.querySelector('#score-text');
                    this.timerText = document.querySelector('#timer-text');
                    this.timeLeft = this.data.gameDuration / 1000;
                    this.gameTimer = null;
                    this.moleTimer = null;
                    
                    this.startGame();
                },
                
                startGame: function() {
                    this.score = 0;
                    this.updateScore(0);
                    this.timeLeft = this.data.gameDuration / 1000;
                    this.timerText.setAttribute('value', 'Time: ' + this.timeLeft);

                    this.gameTimer = setInterval(() => {
                        this.timeLeft--;
                        this.timerText.setAttribute('value', 'Time: ' + this.timeLeft);
                        if (this.timeLeft <= 0) {
                            this.endGame();
                        }
                    }, 1000);

                    this.moleTimer = setInterval(this.spawnMole.bind(this), 1000);
                },

                endGame: function() {
                    clearInterval(this.gameTimer);
                    clearInterval(this.moleTimer);
                    this.timerText.setAttribute('value', 'Game Over!');
                    // Remove any remaining moles
                    document.querySelectorAll('.mole-entity').forEach(mole => mole.parentNode.removeChild(mole));
                },

                spawnMole: function () {
                    const availableHoles = Array.from(this.holes).filter(hole => !hole.querySelector('.mole-entity'));
                    if (availableHoles.length === 0) return;

                    const randomHole = availableHoles[Math.floor(Math.random() * availableHoles.length)];
                    const mole = document.createElement('a-entity');
                    
                    mole.setAttribute('class', 'mole-entity');
                    mole.setAttribute('position', {x: 0, y: -0.8, z: 0});
                    mole.setAttribute('material', 'color', '#654321');

                    // Randomly choose shape
                    if (Math.random() > 0.5) {
                        mole.setAttribute('geometry', 'primitive: box; width: 0.5; height: 0.8; depth: 0.5');
                    } else {
                        mole.setAttribute('geometry', 'primitive: sphere; radius: 0.3');
                        mole.setAttribute('position', {x: 0, y: -0.5, z: 0});
                    }
                    
                    // --- REVISED ANIMATION LOGIC ---
                    mole.setAttribute('animation__up', {
                        property: 'position.y',
                        to: 0.4,
                        dur: 300,
                        easing: 'easeOutQuad',
                        startEvents: 'pop'
                    });
                    mole.setAttribute('animation__down', {
                        property: 'position.y',
                        to: -0.8,
                        dur: 200,
                        easing: 'easeInQuad',
                        startEvents: 'hide'
                    });

                    // Function to remove mole safely
                    const removeMole = () => {
                        if (mole.parentNode) {
                            mole.parentNode.removeChild(mole);
                        }
                    };

                    // Listen for when the 'up' animation finishes
                    mole.addEventListener('animationcomplete__up', () => {
                        // After it's up, wait a bit, then trigger the 'hide' animation
                        setTimeout(() => {
                            mole.emit('hide');
                        }, 1200);
                    });

                    // Listen for when the 'down' animation finishes, then remove the mole
                    mole.addEventListener('animationcomplete__down', removeMole);

                    // Handle being whacked
                    mole.addEventListener('click', () => {
                        this.updateScore(1);
                        // Stop listening to other animation events to prevent errors
                        mole.removeEventListener('animationcomplete__up', null);
                        mole.removeEventListener('animationcomplete__down', null);
                        removeMole();
                    });
                    
                    randomHole.appendChild(mole);
                    mole.emit('pop'); // Start the 'up' animation
                },

                updateScore: function(points) {
                    this.score += points;
                    this.scoreText.setAttribute('value', 'Score: ' + this.score);
                }
            });
        </script>

        <a-entity game-logic></a-entity>
    </a-scene>
</body>
</html>
